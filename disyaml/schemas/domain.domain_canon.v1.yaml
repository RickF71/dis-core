meta:
  schema_id: domain.domain_canon
  schema_version: v1.0
  description: >
    Canonical structure for domain definition files in DIS.
    Each domain YAML represents a single, human-recognizable
    domain instance whose hierarchy is derived from its
    `parent_domain_ref`. Composition is computed, not declared.

  author: dis-core.committee
  date_frozen: 2025-10-29
  integrity_hash: "<auto-filled-by-registry>"

# -------------------------------------------------------------------
# 1. Header â€” required meta fields
# -------------------------------------------------------------------
fields:
  - id: schema_id
    type: string
    required: true
    description: >
      Identifier of the schema this domain conforms to. Must match a
      schema registered in the schema registry.
  - id: schema_version
    type: string
    required: true
    description: >
      Version of the schema. Must start with 'v' and contain a dot.
  - id: schema_hash
    type: string
    required: false
    description: >
      Optional SHA256 hash verifying the schema integrity at import.
  - id: name
    type: string
    required: true
    description: Human-readable domain name.
  - id: uuid
    type: string
    required: true
    description: >
      Globally unique DIS_UID for this domain instance.
  - id: parent_domain_ref
    type: string
    required: false
    description: >
      Optional reference to parent domain (e.g. domain.terra, domain.usa).

# -------------------------------------------------------------------
# 2. Derived properties (computed by system, not stored canonically)
# -------------------------------------------------------------------
derived:
  composition:
    description: >
      A computed list of all domains that reference this domain as
      `parent_domain_ref`. This field is excluded from canonical
      YAMLs and may appear only in auto-generated reflections.

# -------------------------------------------------------------------
# 3. Example (valid canonical domain YAML)
# -------------------------------------------------------------------
example: |
  meta:
    schema_id: domain.government
    schema_version: v1.1
    name: United States of America
    uuid: id-domain-usa
    parent_domain_ref: domain.terra

  authority:
    type: democratic_federation
    seat_of_power: washington_dc

  governance:
    executive: president
    legislative: congress
    judicial: supreme_court

# -------------------------------------------------------------------
# 4. Validation principles
# -------------------------------------------------------------------
rules:
  - "A domain file must begin with a meta block containing schema_id and schema_version."
  - "The parent_domain_ref field defines hierarchy; parent composition is derived dynamically."
  - "composition fields, if present, must be tagged as derived and excluded from canonical imports."
  - "Each (uuid, schema_id, schema_version) triplet must be unique within a domain registry."
  - "Domains must validate successfully against the schema referenced by schema_id/schema_version."

# -------------------------------------------------------------------
# 5. Notes
# -------------------------------------------------------------------
notes:
  - "The presence of parent_domain_ref in children forms the authoritative structure."
  - "Parent domains gain structure from their children, consistent with the Origin of Order Axiom."
  - "composition sections are generated by ledger reflection into the _auto/ directory."
  - "All canonical domains are hash-verified and receipt-logged upon import."
