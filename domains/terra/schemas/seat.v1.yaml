# DIS-PERSONAL / schemas/seat.v1.yaml
# Spec: Seats of Power â€” localized, consent-anchored authority nodes with per-seat receipt chains.
version: 1
kind: schema
name: dis-personal.seat.v1
dis_core_binding: v1.0

$schema: "https://json-schema.org/draft/2020-12/schema"
type: object
additionalProperties: false
required:
  - seat_id
  - domain_ref
  - seat_holder
  - lineage
  - policy
  - receipts
properties:
  seat_id:
    type: string
    pattern: "^[a-z0-9][a-z0-9_-]{2,63}$"

  domain_ref:
    type: string
    description: "Fully qualified DIS domain identifier (e.g., terra.main or simula.terra)."

  seat_label:
    type: string
    minLength: 1
    description: "Human-readable name for UI surfaces."

  seat_holder:
    type: object
    additionalProperties: false
    required: [entity_id, entity_type, status, tech_participation]
    properties:
      entity_id:
        type: string
      entity_type:
        type: string
        enum: [individual, corporation, ai, community]
      status:
        type: string
        enum: [dis, nodis]
        description: "NODIS seat holders are allowed only in containment/testing contexts; issuance rules below restrict actions."
      tech_participation:
        type: string
        enum: [full, limited, notech]

  lineage:
    type: object
    additionalProperties: false
    required: [anchor_receipt, parent_authority_ref]
    properties:
      anchor_receipt:
        type: string
        description: "Receipt hash (hex/base58) anchoring this seat to DIS-CORE authority.root."
      parent_authority_ref:
        type: string
        description: "Upstream authority reference (e.g., domain authority record or prior seat)."
      succession:
        type: array
        items:
          type: object
          additionalProperties: false
          required: [from, to, receipt]
          properties:
            from: { type: string }
            to:   { type: string }
            receipt: { type: string }

  policy:
    type: object
    additionalProperties: false
    required: [issue_receipts, verify_lineage, reject_unanchored, issue_to]
    properties:
      issue_receipts: { type: boolean, const: true }
      verify_lineage: { type: boolean, const: true }
      reject_unanchored: { type: boolean, const: true }
      # DIS-only issuance by default
      issue_to:
        type: string
        enum: [dis_only, allow_nodis_via_containment]
      containment_profile_ref:
        type: [string, "null"]
        description: "Optional profile for NODIS interaction (must exist if issue_to == allow_nodis_via_containment)."

  receipts:
    type: object
    additionalProperties: false
    required: [chain_id, head, items]
    properties:
      chain_id:
        type: string
        pattern: "^seat:[a-z0-9_-]{3,64}$"
      head:
        type: string
        description: "Hash of most recent receipt."
      items:
        type: array
        items:
          type: object
          additionalProperties: false
          required: [rid, ts, action, actor, payload_hash, prev]
          properties:
            rid: { type: string }        # receipt id (hash)
            ts:  { type: string, format: date-time }
            action:
              type: string
              enum:
                - attest
                - delegate
                - revoke
                - approve_contract
                - bind_policy
                - unbind_policy
                - note
            actor:
              type: object
              additionalProperties: false
              required: [entity_id, status]
              properties:
                entity_id: { type: string }
                status: { type: string, enum: [dis, nodis] }
            payload_ref: { type: ["string","null"] }   # optional URI to full payload
            payload_hash: { type: string }
            prev: { type: ["string","null"] }         # previous receipt hash; null for genesis

# --- Example (non-normative) ---
example:
  seat_id: "seat_terra_core"
  domain_ref: "terra"
  seat_label: "Terra Core Authority"
  seat_holder:
    entity_id: "did:dis:terra:authority.core"
    entity_type: "community"
    status: "dis"
    tech_participation: "full"
  lineage:
    anchor_receipt: "0xabc123..."
    parent_authority_ref: "authority.root:terra"
    succession: []
  policy:
    issue_receipts: true
    verify_lineage: true
    reject_unanchored: true
    issue_to: "dis_only"
    containment_profile_ref: null
  receipts:
    chain_id: "seat:terra_core"
    head: null
    items: []
